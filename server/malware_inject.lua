RegisterServerEvent('adi_phone:server:sendMalware')
AddEventHandler('adi_phone:server:sendMalware', function(targetNumber)
    local src = source
    local targetId = GetIdFromNumber(targetNumber)

    if targetId then
        TriggerClientEvent('adi_phone:client:receiveMalware', targetId)
        TriggerClientEvent('adi_phone:notification', src, "NEXUS", "Trojan Injected successfully.")
    end
end)

-- Client Side (The Victim)
RegisterNetEvent('adi_phone:client:receiveMalware')
AddEventHandler('adi_phone:client:receiveMalware', function()
    -- Apply intense glitch effect to NUI
    SendNUIMessage({ action = "forceGlitch", duration = 60000 })
    
    -- Disable controls
    Citizen.CreateThread(function()
        local endTimer = GetGameTimer() + 60000
        while GetGameTimer() < endTimer do
            DisableControlAction(0, 288, true) -- Disable phone key
            Wait(0)
        end
    end)
end)
